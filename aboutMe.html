<div class="aboutme-content">
    <!-- Profile Information Card -->
    <div class="profile-info-container">
        <div class="profile-avatar">
            <img src="user.png" alt="Profile Picture" id="profile-image">
            <button class="edit-avatar-btn" id="edit-avatar-btn">âœŽ</button>
        </div>
    </div>

    <!-- Personal Information Sections -->
    <div class="info-sections">
        <!-- Name Section -->
        <div class="info-card active">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Full Name</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn" onclick="event.stopPropagation(); editField('name')">Edit</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <p id="name-display">John Doe</p>
                <div class="info-edit-form" id="name-edit" style="display: none;">
                    <input type="text" id="name-input" placeholder="Enter your full name">
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEdit('name')">Cancel</button>
                        <button class="btn-save" onclick="saveField('name')">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Birthday Section -->
        <div class="info-card">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Birthday</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn" onclick="event.stopPropagation(); editField('birthday')">Edit</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <p id="birthday-display">January 1, 2000</p>
                <div class="info-edit-form" id="birthday-edit" style="display: none;">
                    <input type="date" id="birthday-input">
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEdit('birthday')">Cancel</button>
                        <button class="btn-save" onclick="saveField('birthday')">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Section -->
        <div class="info-card">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Email</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn" onclick="event.stopPropagation(); editField('email')">Edit</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <p id="email-display">biovibe@example.com</p>
                <div class="info-edit-form" id="email-edit" style="display: none;">
                    <input type="email" id="email-input" placeholder="Enter your email">
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEdit('email')">Cancel</button>
                        <button class="btn-save" onclick="saveField('email')">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phone Section -->
        <div class="info-card">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Phone</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn" onclick="event.stopPropagation(); editField('phone')">Edit</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <p id="phone-display">(555) 123-4567</p>
                <div class="info-edit-form" id="phone-edit" style="display: none;">
                    <input type="tel" id="phone-input" placeholder="Enter your phone number">
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEdit('phone')">Cancel</button>
                        <button class="btn-save" onclick="saveField('phone')">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Section -->
        <div class="info-card">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Location</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn" onclick="event.stopPropagation(); editField('location')">Edit</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <p id="location-display">City, State</p>
                <div class="info-edit-form" id="location-edit" style="display: none;">
                    <input type="text" id="location-input" placeholder="Enter your location">
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEdit('location')">Cancel</button>
                        <button class="btn-save" onclick="saveField('location')">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bio Section -->
        <div class="info-card">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Bio</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn" onclick="event.stopPropagation(); editField('bio')">Edit</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <p id="bio-display">Write a few words about yourself...</p>
                <div class="info-edit-form" id="bio-edit" style="display: none;">
                    <textarea id="bio-input" placeholder="Enter your bio" rows="4"></textarea>
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEdit('bio')">Cancel</button>
                        <button class="btn-save" onclick="saveField('bio')">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contacts Section -->
        <div class="info-card emergency-contacts-card">
            <div class="info-header" onclick="toggleAccordion(this)">
                <div class="info-label">
                    <h3>Emergency Contacts</h3>
                </div>
                <div class="header-actions">
                    <button class="edit-btn add-contact-btn" onclick="event.stopPropagation(); showAddContactForm()">Add Contact</button>
                    <span class="accordion-arrow">â–¼</span>
                </div>
            </div>
            <div class="info-content">
                <div id="emergency-contacts-list" class="contacts-list">
                    <!-- Contacts will be populated here -->
                </div>
                
                <!-- Add Contact Form -->
                <div class="contact-form" id="add-contact-form" style="display: none;">
                    <h4 class="form-title">Add Emergency Contact</h4>
                    <input type="text" id="contact-name-input" placeholder="Full Name *" required>
                    <input type="text" id="contact-relationship-input" placeholder="Relationship *" required>
                    <input type="tel" id="contact-phone-input" placeholder="Phone Number *" required>
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelAddContact()">Cancel</button>
                        <button class="btn-save" onclick="saveNewContact()">Add Contact</button>
                    </div>
                </div>

                <!-- Edit Contact Form -->
                <div class="contact-form" id="edit-contact-form" style="display: none;">
                    <h4 class="form-title">Edit Emergency Contact</h4>
                    <input type="text" id="edit-contact-name-input" placeholder="Full Name *" required>
                    <input type="text" id="edit-contact-relationship-input" placeholder="Relationship *" required>
                    <input type="tel" id="edit-contact-phone-input" placeholder="Phone Number *" required>
                    <input type="hidden" id="edit-contact-id">
                    <div class="form-buttons">
                        <button class="btn-cancel" onclick="cancelEditContact()">Cancel</button>
                        <button class="btn-save" onclick="saveEditedContact()">Save Changes</button>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-contacts" id="empty-contacts-message">
                    <p>No emergency contacts added yet</p>
                    <p class="empty-subtext">Add trusted contacts who can be reached in case of emergency</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.aboutme-content * {
    box-sizing: border-box;
}

.aboutme-content {
    padding: 20px;
    padding-bottom: 60px;
    background: var(--light-lavender);
    flex: 1 1 0;
    overflow-y: auto;
    overflow-x: hidden;
    max-width: 100%;
    box-sizing: border-box;
    min-height: 0;
    -webkit-overflow-scrolling: touch;
}

.profile-info-container {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
    padding: 30px 0;
}

.profile-avatar {
    position: relative;
    width: 150px;
    height: 150px;
}

.profile-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid var(--purple);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.edit-avatar-btn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--purple);
    color: white;
    border: 3px solid white;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.edit-avatar-btn:hover {
    background: var(--dark-purple);
    transform: scale(1.1);
}

.info-sections {
    max-width: 800px;
    width: 100%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
    box-sizing: border-box;
    padding: 0 10px;
}

.info-card {
    background: var(--white);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    box-sizing: border-box;
    max-width: 100%;
    overflow: hidden;
}

.info-card:hover {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
}

.info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0;
    cursor: pointer;
    padding: 5px;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.info-header:hover {
    background-color: var(--light-grey);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 12px;
}

.accordion-arrow {
    font-size: 0.8rem;
    color: var(--purple);
    transition: transform 0.3s ease;
}

.info-card.active .accordion-arrow {
    transform: rotate(180deg);
}

.info-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, margin-top 0.4s ease, opacity 0.4s ease;
    opacity: 0;
}

.info-card.active .info-content {
    max-height: 2000px;
    margin-top: 15px;
    opacity: 1;
}

/* Ensure emergency contacts section has enough space */
.info-card.emergency-contacts-card.active .info-content {
    max-height: 3000px;
}

.info-label {
    display: flex;
    align-items: center;
    gap: 12px;
}

.info-icon {
    font-size: 1.5rem;
}

.info-label h3 {
    margin: 0;
    font-size: 1.2rem;
    color: var(--black);
    font-weight: 600;
}

.edit-btn {
    background: var(--greyish-purple);
    color: var(--purple);
    border: none;
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.edit-btn:hover {
    background: var(--purple);
    color: white;
    transform: translateY(-2px);
}

.info-content p {
    margin: 0;
    font-size: 1rem;
    color: var(--dark-grey);
    line-height: 1.6;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    max-width: 100%;
}

.info-edit-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.info-edit-form input,
.info-edit-form textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--greyish-purple);
    border-radius: 8px;
    font-size: 1rem;
    font-family: Arial, sans-serif;
    outline: none;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
}

.info-edit-form input:focus,
.info-edit-form textarea:focus {
    border-color: var(--purple);
}

.info-edit-form textarea {
    resize: vertical;
    min-height: 100px;
}

.form-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.btn-cancel,
.btn-save {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-cancel {
    background: var(--light-grey);
    color: var(--dark-grey);
}

.btn-cancel:hover {
    background: var(--greyish-purple);
}

.btn-save {
    background: var(--purple);
    color: white;
}

.btn-save:hover {
    background: var(--dark-purple);
    transform: translateY(-1px);
}

/* Responsive design */
@media (max-width: 768px) {
    .aboutme-content {
        padding: 15px 10px;
        padding-bottom: 80px;
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
    }

    .info-sections {
        padding: 0 5px;
    }

    .info-card {
        padding: 20px 15px;
    }

    .info-header {
        padding: 8px;
    }

    .header-actions {
        gap: 8px;
    }

    .edit-btn {
        padding: 6px 15px;
        font-size: 0.85rem;
    }

    .info-label h3 {
        font-size: 1.1rem;
    }
}

@media (max-width: 480px) {
    .aboutme-content {
        padding: 10px 5px;
        padding-bottom: 100px;
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
    }

    .edit-avatar-btn {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }

    .info-sections {
        padding: 0;
        gap: 15px;
    }

    .info-card {
        padding: 15px 10px;
    }

    .info-icon {
        font-size: 1.2rem;
    }

    .info-label h3 {
        font-size: 1rem;
    }

    .form-buttons {
        flex-direction: column;
    }

    .btn-cancel,
    .btn-save {
        width: 100%;
    }
}

/* Emergency Contacts Styles */
.contacts-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.contact-item {
    background: var(--light-lavender);
    border-radius: 10px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.contact-item:hover {
    border-color: var(--purple);
    transform: translateX(5px);
}

.contact-info {
    flex: 1;
}

.contact-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--black);
    margin-bottom: 5px;
}

.contact-details {
    display: flex;
    flex-direction: column;
    gap: 3px;
}

.contact-relationship,
.contact-phone {
    font-size: 0.9rem;
    color: var(--dark-grey);
}

.contact-phone {
    font-weight: 500;
    color: var(--purple);
}

.contact-actions {
    display: flex;
    gap: 8px;
}

.contact-action-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.edit-contact-btn {
    background: var(--greyish-purple);
    color: var(--purple);
}

.edit-contact-btn:hover {
    background: var(--purple);
    color: white;
    transform: scale(1.1);
}

.delete-contact-btn {
    background: #ffeaea;
    color: #f44336;
}

.delete-contact-btn:hover {
    background: #f44336;
    color: white;
    transform: scale(1.1);
}

.call-contact-btn {
    background: #e8f5e8;
    color: #4CAF50;
}

.call-contact-btn:hover {
    background: #4CAF50;
    color: white;
    transform: scale(1.1);
}

.contact-form {
    background: var(--light-lavender);
    padding: 20px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 15px;
}

.form-title {
    margin: 0 0 10px 0;
    color: var(--purple);
    font-size: 1.1rem;
}

.contact-form input[type="text"],
.contact-form input[type="tel"] {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--greyish-purple);
    border-radius: 8px;
    font-size: 1rem;
    font-family: Arial, sans-serif;
    outline: none;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
}

.contact-form input:focus {
    border-color: var(--purple);
}

.empty-contacts {
    text-align: center;
    padding: 40px 20px;
    color: var(--dark-grey);
}

.empty-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: 15px;
    opacity: 0.5;
}

.empty-contacts p {
    margin: 5px 0;
    font-size: 1rem;
}

.empty-subtext {
    font-size: 0.85rem;
    opacity: 0.7;
}

@media (max-width: 768px) {
    .contact-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }

    .contact-actions {
        align-self: flex-end;
    }
}

@media (max-width: 480px) {
    .contact-actions {
        width: 100%;
        justify-content: flex-end;
    }

    .contact-action-btn {
        width: 32px;
        height: 32px;
        font-size: 0.9rem;
    }
}
</style>

<script>
// Store original values for cancel functionality
let originalValues = {};

// Store emergency contacts
let emergencyContacts = [];

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    loadProfileData();
    initializeAvatarUpload();
    loadEmergencyContacts();
    renderEmergencyContacts();
});

// Toggle accordion
function toggleAccordion(headerElement) {
    const card = headerElement.closest('.info-card');
    const wasActive = card.classList.contains('active');
    
    // Optionally close all other accordions (uncomment for single-open behavior)
    // document.querySelectorAll('.info-card').forEach(c => c.classList.remove('active'));
    
    // Toggle current accordion
    if (wasActive) {
        card.classList.remove('active');
    } else {
        card.classList.add('active');
    }
}

// Load profile data from localStorage or use defaults
function loadProfileData() {
    const fields = ['name', 'birthday', 'email', 'phone', 'location', 'bio'];
    
    fields.forEach(field => {
        const savedValue = localStorage.getItem(`profile_${field}`);
        if (savedValue) {
            const displayElement = document.getElementById(`${field}-display`);
            if (field === 'birthday') {
                displayElement.textContent = formatDate(savedValue);
            } else {
                displayElement.textContent = savedValue;
            }
        }
    });

    // Load profile image if saved
    const savedImage = localStorage.getItem('profile_image');
    if (savedImage) {
        document.getElementById('profile-image').src = savedImage;
    }
}

// Initialize avatar upload functionality
function initializeAvatarUpload() {
    const editAvatarBtn = document.getElementById('edit-avatar-btn');
    
    editAvatarBtn.addEventListener('click', function() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.getElementById('profile-image');
                    img.src = event.target.result;
                    localStorage.setItem('profile_image', event.target.result);
                };
                reader.readAsDataURL(file);
            }
        };
        
        input.click();
    });
}

// Edit a field
function editField(fieldName) {
    const displayElement = document.getElementById(`${fieldName}-display`);
    const editForm = document.getElementById(`${fieldName}-edit`);
    const inputElement = document.getElementById(`${fieldName}-input`);
    
    // Store original value
    originalValues[fieldName] = displayElement.textContent;
    
    // Hide display, show edit form
    displayElement.style.display = 'none';
    editForm.style.display = 'flex';
    
    // Set current value in input
    if (fieldName === 'birthday') {
        // Convert displayed date back to YYYY-MM-DD format
        const savedValue = localStorage.getItem(`profile_${fieldName}`) || '2000-01-01';
        inputElement.value = savedValue;
    } else {
        inputElement.value = displayElement.textContent;
    }
    
    inputElement.focus();
}

// Cancel edit
function cancelEdit(fieldName) {
    const displayElement = document.getElementById(`${fieldName}-display`);
    const editForm = document.getElementById(`${fieldName}-edit`);
    
    // Show display, hide edit form
    displayElement.style.display = 'block';
    editForm.style.display = 'none';
    
    // Restore original value
    if (originalValues[fieldName]) {
        displayElement.textContent = originalValues[fieldName];
    }
}

// Save field
function saveField(fieldName) {
    const displayElement = document.getElementById(`${fieldName}-display`);
    const editForm = document.getElementById(`${fieldName}-edit`);
    const inputElement = document.getElementById(`${fieldName}-input`);
    const newValue = inputElement.value.trim();
    
    if (!newValue && fieldName !== 'bio') {
        alert('Please enter a value');
        inputElement.focus();
        return;
    }
    
    // Validate email if email field
    if (fieldName === 'email' && newValue) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(newValue)) {
            alert('Please enter a valid email address');
            inputElement.focus();
            return;
        }
    }
    
    // Update display
    if (fieldName === 'birthday') {
        displayElement.textContent = formatDate(newValue);
        localStorage.setItem(`profile_${fieldName}`, newValue);
    } else {
        displayElement.textContent = newValue || 'Not specified';
        localStorage.setItem(`profile_${fieldName}`, newValue);
    }
    
    // Show display, hide edit form
    displayElement.style.display = 'block';
    editForm.style.display = 'none';
    
    // Animation
    displayElement.style.opacity = '0';
    setTimeout(() => {
        displayElement.style.transition = 'opacity 0.3s ease';
        displayElement.style.opacity = '1';
    }, 10);
}

// Format date from YYYY-MM-DD to "Month Day, Year"
function formatDate(dateString) {
    const date = new Date(dateString + 'T00:00:00');
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        // Cancel all open edit forms
        const editForms = document.querySelectorAll('.info-edit-form');
        editForms.forEach(form => {
            if (form.style.display === 'flex') {
                const fieldName = form.id.replace('-edit', '');
                cancelEdit(fieldName);
            }
        });
    }
});

// Handle Enter key in input fields
document.querySelectorAll('.info-edit-form input').forEach(input => {
    input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const fieldName = this.id.replace('-input', '');
            saveField(fieldName);
        }
    });
});

// ===== Emergency Contacts Functions =====

// Load emergency contacts from localStorage
function loadEmergencyContacts() {
    const saved = localStorage.getItem('emergency_contacts');
    if (saved) {
        emergencyContacts = JSON.parse(saved);
    }
}

// Save emergency contacts to localStorage
function saveEmergencyContacts() {
    localStorage.setItem('emergency_contacts', JSON.stringify(emergencyContacts));
}

// Render emergency contacts list
function renderEmergencyContacts() {
    const listContainer = document.getElementById('emergency-contacts-list');
    const emptyMessage = document.getElementById('empty-contacts-message');
    
    if (emergencyContacts.length === 0) {
        listContainer.innerHTML = '';
        emptyMessage.style.display = 'block';
    } else {
        emptyMessage.style.display = 'none';
        listContainer.innerHTML = emergencyContacts.map(contact => `
            <div class="contact-item">
                <div class="contact-info">
                    <div class="contact-name">${escapeHtml(contact.name)}</div>
                    <div class="contact-details">
                        <div class="contact-relationship">${escapeHtml(contact.relationship)}</div>
                        <div class="contact-phone">${escapeHtml(contact.phone)}</div>
                    </div>
                </div>
                <div class="contact-actions">
                    <button class="contact-action-btn call-contact-btn" onclick="callContact('${escapeHtml(contact.phone)}')" title="Call">
                        ðŸ“ž
                    </button>
                    <button class="contact-action-btn edit-contact-btn" onclick="editContact('${contact.id}')" title="Edit">
                        âœŽ
                    </button>
                    <button class="contact-action-btn delete-contact-btn" onclick="deleteContact('${contact.id}')" title="Delete">
                        âœ•
                    </button>
                </div>
            </div>
        `).join('');
    }
}

// Show add contact form
function showAddContactForm() {
    document.getElementById('add-contact-form').style.display = 'flex';
    document.getElementById('contact-name-input').focus();
}

// Cancel add contact
function cancelAddContact() {
    document.getElementById('add-contact-form').style.display = 'none';
    document.getElementById('contact-name-input').value = '';
    document.getElementById('contact-relationship-input').value = '';
    document.getElementById('contact-phone-input').value = '';
}

// Save new contact
function saveNewContact() {
    const name = document.getElementById('contact-name-input').value.trim();
    const relationship = document.getElementById('contact-relationship-input').value.trim();
    const phone = document.getElementById('contact-phone-input').value.trim();
    
    if (!name || !relationship || !phone) {
        alert('Please fill in all fields');
        return;
    }
    
    // Validate phone number (basic validation)
    const phoneRegex = /^[\d\s\-\(\)\+]+$/;
    if (!phoneRegex.test(phone)) {
        alert('Please enter a valid phone number');
        return;
    }
    
    const newContact = {
        id: Date.now().toString(),
        name: name,
        relationship: relationship,
        phone: phone
    };
    
    emergencyContacts.push(newContact);
    saveEmergencyContacts();
    renderEmergencyContacts();
    cancelAddContact();
    
    // Show success animation
    setTimeout(() => {
        const lastContact = document.querySelector('.contact-item:last-child');
        if (lastContact) {
            lastContact.style.animation = 'slideIn 0.3s ease';
        }
    }, 10);
}

// Edit contact
function editContact(contactId) {
    const contact = emergencyContacts.find(c => c.id === contactId);
    if (!contact) return;
    
    document.getElementById('edit-contact-name-input').value = contact.name;
    document.getElementById('edit-contact-relationship-input').value = contact.relationship;
    document.getElementById('edit-contact-phone-input').value = contact.phone;
    document.getElementById('edit-contact-id').value = contact.id;
    
    document.getElementById('edit-contact-form').style.display = 'flex';
    document.getElementById('edit-contact-name-input').focus();
}

// Cancel edit contact
function cancelEditContact() {
    document.getElementById('edit-contact-form').style.display = 'none';
    document.getElementById('edit-contact-name-input').value = '';
    document.getElementById('edit-contact-relationship-input').value = '';
    document.getElementById('edit-contact-phone-input').value = '';
    document.getElementById('edit-contact-id').value = '';
}

// Save edited contact
function saveEditedContact() {
    const id = document.getElementById('edit-contact-id').value;
    const name = document.getElementById('edit-contact-name-input').value.trim();
    const relationship = document.getElementById('edit-contact-relationship-input').value.trim();
    const phone = document.getElementById('edit-contact-phone-input').value.trim();
    
    if (!name || !relationship || !phone) {
        alert('Please fill in all fields');
        return;
    }
    
    // Validate phone number
    const phoneRegex = /^[\d\s\-\(\)\+]+$/;
    if (!phoneRegex.test(phone)) {
        alert('Please enter a valid phone number');
        return;
    }
    
    const contactIndex = emergencyContacts.findIndex(c => c.id === id);
    if (contactIndex !== -1) {
        emergencyContacts[contactIndex] = {
            id: id,
            name: name,
            relationship: relationship,
            phone: phone
        };
        
        saveEmergencyContacts();
        renderEmergencyContacts();
        cancelEditContact();
    }
}

// Delete contact
function deleteContact(contactId) {
    if (confirm('Are you sure you want to delete this emergency contact?')) {
        emergencyContacts = emergencyContacts.filter(c => c.id !== contactId);
        saveEmergencyContacts();
        renderEmergencyContacts();
    }
}

// Call contact
function callContact(phone) {
    window.location.href = `tel:${phone}`;
}

// Escape HTML to prevent XSS
function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
}

// Add slide-in animation
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(-20px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
`;
document.head.appendChild(style);
</script>

