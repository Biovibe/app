<div class="mystress-content">
    <!-- Date Navigation -->
    <div class="date-navigation">
        <button class="nav-arrow" id="prev-date">&#8249;</button>
        <div class="date-display" id="date-display">
            <span class="current-date" id="current-date">Today</span>
            <span class="dropdown-arrow">&#9662;</span>
        </div>
        <button class="nav-arrow" id="next-date">&#8250;</button>
    </div>

    <!-- Date Picker Modal -->
    <div class="date-picker-modal" id="date-picker-modal">
        <div class="date-picker-content">
            <input type="date" id="date-picker" />
            <div class="date-picker-buttons">
                <button id="date-picker-cancel">Cancel</button>
                <button id="date-picker-confirm">Select</button>
            </div>
        </div>
    </div>

    <!-- Time Period Selector -->
    <div class="time-period-selector">
        <button class="period-btn active" data-period="day" id="period-day">Day</button>
        <button class="period-btn" data-period="week" id="period-week">Week</button>
        <button class="period-btn" data-period="month" id="period-month">Month</button>
    </div>

    <!-- Placeholder for chart and other components -->
    <div class="chart-placeholder">
        <p>Chart and session components will be added here</p>
    </div>
</div>

<style>
.mystress-content {
    padding: 20px;
    background: var(--light-lavender);
    min-height: 500px;
}

.date-navigation {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    gap: 20px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.nav-arrow {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--dark-grey);
    cursor: pointer;
    padding: 10px;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.nav-arrow:hover {
    background: var(--greyish-purple);
    color: var(--purple);
}

.date-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--black);
    cursor: pointer;
    flex: 1;
    text-align: center;
}

.dropdown-arrow {
    color: var(--purple);
    font-size: 0.8rem;
}

.time-period-selector {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-bottom: 30px;
}

.period-btn {
    padding: 8px 20px;
    border: none;
    background: var(--white);
    color: var(--dark-grey);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.period-btn.active {
    background: var(--purple);
    color: var(--white);
}

.period-btn:hover:not(.active) {
    background: var(--greyish-purple);
}

.chart-placeholder {
    text-align: center;
    padding: 40px;
    background: var(--white);
    border-radius: 15px;
    margin: 20px 0;
    color: var(--dark-grey);
}

/* Date Picker Modal */
.date-picker-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.date-picker-modal.show {
    display: flex;
}

.date-picker-content {
    background: var(--white);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    text-align: center;
    min-width: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.date-picker-content input[type="date"] {
    width: 200px;
    padding: 12px;
    border: 2px solid var(--greyish-purple);
    border-radius: 8px;
    font-size: 1rem;
    margin-bottom: 20px;
    outline: none;
    transition: border-color 0.3s ease;
    text-align: center;
}

.date-picker-content input[type="date"]:focus {
    border-color: var(--purple);
}

.date-picker-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.date-picker-buttons button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

#date-picker-cancel {
    background: var(--light-grey);
    color: var(--dark-grey);
}

#date-picker-cancel:hover {
    background: var(--greyish-purple);
}

#date-picker-confirm {
    background: var(--purple);
    color: var(--white);
}

#date-picker-confirm:hover {
    background: var(--dark-purple);
}

/* Enhanced date display cursor */
.date-display {
    cursor: pointer;
    transition: all 0.3s ease;
}

.date-display:hover {
    color: var(--purple);
}

/* Responsive design */
@media (max-width: 768px) {
    .mystress-content {
        padding: 15px;
    }
    
    .date-navigation {
        gap: 15px;
    }
    
    .date-display {
        font-size: 1rem;
    }
    
    .period-btn {
        padding: 6px 15px;
        font-size: 0.8rem;
    }
}
</style>

<script>
// Global variables
let currentDate = new Date();
let currentPeriod = 'day';

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    updateDateDisplay();
    initializeEventListeners();
});

// Update the date display text
function updateDateDisplay() {
    const dateElement = document.getElementById('current-date');
    const today = new Date();
    
    // Format the date based on the current period
    if (currentPeriod === 'day') {
        // Always show the formatted date, including "Today, Month Day" for today
        dateElement.textContent = formatDate(currentDate);
    } else if (currentPeriod === 'week') {
        const weekRange = getWeekRange(currentDate);
        dateElement.textContent = `${formatShortDate(weekRange.start)} - ${formatShortDate(weekRange.end)}`;
    } else if (currentPeriod === 'month') {
        dateElement.textContent = formatMonth(currentDate);
    }
}

// Format date as "Today, Jun 3" or "Monday, Jun 3"
function formatDate(date) {
    const today = new Date();
    const options = { weekday: 'long', month: 'short', day: 'numeric' };
    
    if (isSameDay(date, today)) {
        return 'Today, ' + date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    } else {
        return date.toLocaleDateString('en-US', options);
    }
}

// Format short date as "Jun 3"
function formatShortDate(date) {
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Format month as "June 2024"
function formatMonth(date) {
    return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
}

// Check if two dates are the same day
function isSameDay(date1, date2) {
    return date1.toDateString() === date2.toDateString();
}

// Get week range (Sunday to Saturday)
function getWeekRange(date) {
    const start = new Date(date);
    const day = start.getDay();
    const diff = start.getDate() - day;
    
    start.setDate(diff);
    const end = new Date(start);
    end.setDate(start.getDate() + 6);
    
    return { start, end };
}

// Initialize all event listeners
function initializeEventListeners() {
    // Date navigation arrows
    document.getElementById('prev-date').addEventListener('click', function() {
        navigateDate(-1);
    });
    
    document.getElementById('next-date').addEventListener('click', function() {
        navigateDate(1);
    });
    
    // Date display click (show date picker)
    document.getElementById('date-display').addEventListener('click', function() {
        showDatePicker();
    });
    
    // Period buttons
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            changePeriod(this.dataset.period);
        });
    });
    
    // Date picker modal
    document.getElementById('date-picker-cancel').addEventListener('click', function() {
        hideDatePicker();
    });
    
    document.getElementById('date-picker-confirm').addEventListener('click', function() {
        confirmDateSelection();
    });
    
    // Close modal when clicking outside
    document.getElementById('date-picker-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideDatePicker();
        }
    });
}

// Navigate date by increment based on current period
function navigateDate(increment) {
    if (currentPeriod === 'day') {
        currentDate.setDate(currentDate.getDate() + increment);
    } else if (currentPeriod === 'week') {
        currentDate.setDate(currentDate.getDate() + (increment * 7));
    } else if (currentPeriod === 'month') {
        currentDate.setMonth(currentDate.getMonth() + increment);
    }
    
    updateDateDisplay();
    // Here you would typically reload the chart data
    console.log('Date changed to:', currentDate, 'Period:', currentPeriod);
}

// Change the time period (day/week/month)
function changePeriod(newPeriod) {
    // Update active button
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById('period-' + newPeriod).classList.add('active');
    
    currentPeriod = newPeriod;
    updateDateDisplay();
    
    // Here you would typically reload the chart data for the new period
    console.log('Period changed to:', currentPeriod);
}

// Show the date picker modal
function showDatePicker() {
    const modal = document.getElementById('date-picker-modal');
    const datePicker = document.getElementById('date-picker');
    
    // Set the date picker to current date
    datePicker.value = currentDate.toISOString().split('T')[0];
    
    modal.classList.add('show');
}

// Hide the date picker modal
function hideDatePicker() {
    const modal = document.getElementById('date-picker-modal');
    modal.classList.remove('show');
}

// Confirm date selection from picker
function confirmDateSelection() {
    const datePicker = document.getElementById('date-picker');
    const selectedDate = new Date(datePicker.value + 'T00:00:00');
    
    if (selectedDate && !isNaN(selectedDate.getTime())) {
        currentDate = selectedDate;
        updateDateDisplay();
        hideDatePicker();
        
        // Here you would typically reload the chart data
        console.log('Date selected:', currentDate);
    }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
        navigateDate(-1);
    } else if (e.key === 'ArrowRight') {
        navigateDate(1);
    } else if (e.key === 'Escape') {
        hideDatePicker();
    }
});
</script>
